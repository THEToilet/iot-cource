<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xml:lang="ja">
<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" type="text/css" href="epub_style.css" />
<link rel="next" title="APIを使おう！" href="serverclient.html" /><link rel="prev" title="電子部品を使ってみよう" href="electronic.html" />  <meta name="generator" content="Re:VIEW" />
  <title>取得データをWebに公開しよう！ | はじめてのIoT講座</title>
</head>
<body>
  <div class="book">
    <nav class="side-content">
      <h1>はじめてのIoT講座</h1>
      <ul class="book-toc">
<li><a href="index.html">TOP</a></li>
<li><a href="preface.html">はじめに</a></li>
<li><a href="preparation.html">第1章　電子部品の準備</a></li>
<li><a href="environment.html">第2章　環境構築</a></li>
<li><a href="electronic.html">第3章　電子部品を使ってみよう</a></li>
<li><a href="sensor.html">第4章　取得データをWebに公開しよう！</a></li>
<li><a href="serverclient.html">第5章　APIを使おう！</a></li>
<li><a href="pratical.html">第6章　応用編</a></li>
<li><a href="troubleshooting.html">付録A　トラブルシューティング</a></li>
<li><a href="contributors.html">著者紹介</a></li>
</ul>
      <p class="review-signature">powered by <a href="http://reviewml.org/">Re:VIEW</a></p>
    </nav>
    <div class="book-body">
      <header>
      </header>
      <div class="book-page">
        <h1><a id="h4"></a><span class="secno">第4章　</span>取得データをWebに公開しよう！</h1>
<div id="id_6" class="image">
<img src="images/sensor/6.png" alt="今回の目標画面" />
<p class="caption">
図4.1: 今回の目標画面
</p>
</div>

<h2><a id="h4-1"></a><span class="secno">4.1　</span>センサーを使おう</h2>

<h3><a id="h4-1-1"></a>I2Cとは</h3>
<p>	4本の線を接続するだけでセンサーや表示デバイスを手軽に利用できる　　I2C（Inter Integrated Circuit）　　IC間で通信することを目的に、フィリップ社が開発したシリアル通信方式　　　データのやり取りをするSDA（シリアルデータ）と、　　　IC間でタイミングを合わせるのに利用するSCL（シリアルクロック）　　　2本の線をつなげることで、互いにデータのやり取りえをするようになっている　　　　GNDと電源にもつなげるので4本必要　　　I2Cは各種デバイスを制御するマスターと、マスターからの命令によって制御されるスレーブに分かれる　　　マスターはマイコンに当たる　　デバイスを制御する場合に、対象デバイスを指定する必要がある　　　各I2CデバイスにはI2Cアドレスが割り当てられている　　　　アドレスは16進数表記で0x03から0x77までの117個のアドレスが利用できる　　　　大体は製品出荷時にアドレスが割り当てられている</p>

<h4><a id="h4-1-1-1"></a>温湿度センサー</h4>
<p>温度範囲 0~50℃湿度範囲20~90℃動作電圧 3-5.5v電流供給0.5~2.5mA読み取りタイミング一秒間隔毎秒センサー取得できるArduinoIDEを使用したDHT11 / DHT22温度および湿度センサーを備えたESP32https://randomnerdtutorials.com/esp32-dht11-dht22-temperature-humidity-sensor-arduino-ide/</p>
<div id="dht11" class="image">
<img src="images/sensor/dht11.png" alt="dht11" />
<p class="caption">
図4.2: dht11
</p>
</div>
<div id="id_9" class="image">
<img src="images/sensor/9.png" alt="DHT11用ライブラリのインストール" />
<p class="caption">
図4.3: DHT11用ライブラリのインストール
</p>
</div>
<div id="id_8" class="image">
<img src="images/sensor/8.png" alt="依存ライブラリのインストール" />
<p class="caption">
図4.4: 依存ライブラリのインストール
</p>
</div>

<h4><a id="h4-1-1-2"></a>LCD</h4>
<div id="oled" class="image">
<img src="images/sensor/oled.png" alt="oled" />
<p class="caption">
図4.5: oled
</p>
</div>
<div id="id_10" class="image">
<img src="images/sensor/10.png" alt="SSD1306用ライブラリのインストール" />
<p class="caption">
図4.6: SSD1306用ライブラリのインストール
</p>
</div>
<div id="oled" class="caption-code">
<p class="caption">リスト4.1: oled</p>
<pre class="list">#include &lt;Wire.h&gt;
#include &lt;string&gt;
#include &quot;SSD1306.h&quot; //ディスプレイ用ライブラリを読み込み
using namespace std;

SSD1306 display(0x3c, 21, 22); //SSD1306インスタンスの作成（I2Cアドレス,SDA,SCL）

int i = 0;
void setup()
{

  display.init();                          //ディスプレイを初期化
  display.setFont(ArialMT_Plain_16);       //フォントを設定
  display.drawString(0, 0, &quot;Hello World&quot;); //(0,0)の位置にHello Worldを表示
  display.display();                       //指定された情報を描画
}

void loop()
{
  i++;
  display.setPixel(i, i + 10);
  if (i == 100)
  {
    i = 0;
  }
  display.displ
</pre>
</div>
<div id="dht11" class="caption-code">
<p class="caption">リスト4.2: dht11</p>
<pre class="list">// Example testing sketch for various DHT humidity/temperature sensors written by ladyada
  // REQUIRES the following Arduino libraries:
  // - DHT Sensor Library: https://github.com/adafruit/DHT-sensor-library
  // - Adafruit Unified Sensor Lib: https://github.com/adafruit/Adafruit_Sensor

  #include &quot;DHT.h&quot;

  #define DHTPIN 4     // Digital pin connected to the DHT sensor
  // Feather HUZZAH ESP8266 note: use pins 3, 4, 5, 12, 13 or 14 --
  // Pin 15 can work but DHT must be disconnected during program upload.

  // Uncomment whatever type you&#39;re using!
  #define DHTTYPE DHT11   // DHT 11
  //#define DHTTYPE DHT22   // DHT 22  (AM2302), AM2321
  //#define DHTTYPE DHT21   // DHT 21 (AM2301)

  // Connect pin 1 (on the left) of the sensor to +5V
  // NOTE: If using a board with 3.3V logic like an Arduino Due connect pin 1
  // to 3.3V instead of 5V!
  // Connect pin 2 of the sensor to whatever your DHTPIN is
  // Connect pin 4 (on the right) of the sensor to GROUND
  // Connect a 10K resistor from pin 2 (data) to pin 1 (power) of the sensor

  // Initialize DHT sensor.
  // Note that older versions of this library took an optional third parameter to
  // tweak the timings for faster processors.  This parameter is no longer needed
  // as the current DHT reading algorithm adjusts itself to work on faster procs.
  DHT dht(DHTPIN, DHTTYPE);

  void setup() {
    Serial.begin(9600);
    Serial.println(F(&quot;DHTxx test!&quot;));

    dht.begin();
  }

  void loop() {
    // Wait a few seconds between measurements.
    delay(2000);

    // Reading temperature or humidity takes about 250 milliseconds!
    // Sensor readings may also be up to 2 seconds &#39;old&#39; (its a very slow sensor)
    float h = dht.readHumidity();
    // Read temperature as Celsius (the default)
    float t = dht.readTemperature();
    // Read temperature as Fahrenheit (isFahrenheit = true)
    float f = dht.readTemperature(true);

    // Check if any reads failed and exit early (to try again).
    if (isnan(h) || isnan(t) || isnan(f)) {
      Serial.println(F(&quot;Failed to read from DHT sensor!&quot;));
      return;
    }

    // Compute heat index in Fahrenheit (the default)
    float hif = dht.computeHeatIndex(f, h);
    // Compute heat index in Celsius (isFahreheit = false)
    float hic = dht.computeHeatIndex(t, h, false);

    Serial.print(F(&quot;Humidity: &quot;));
    Serial.print(h);
    Serial.print(F(&quot;%  Temperature: &quot;));
    Serial.print(t);
    Serial.print(F(&quot;°C &quot;));
    Serial.print(f);
    Serial.print(F(&quot;°F  Heat index: &quot;));
    Serial.print(hic);
    Serial.print(F(&quot;°C &quot;));
    Serial.print(hif);
    Serial.println(F(&quot;°F&quot;));
  }
</pre>
</div>
<div id="tmp" class="caption-code">
<p class="caption">リスト4.3: tmp</p>
<pre class="list">        Humidity: 56.00%  Temperature: 24.50°C 76.10°F  Heat index: 24.47°C 76.04°F
  Humidity: 56.00%  Temperature: 24.50°C 76.10°F  Heat index: 24.47°C 76.04°F
  Humidity: 56.00%  Temperature: 24.50°C 76.10°F  Heat index: 24.47°C 76.04°F
  Humidity: 57.00%  Temperature: 24.50°C 76.10°F  Heat index: 24.49°C 76.09°F
  Humidity: 57.00%  Temperature: 24.50°C 76.10°F  Heat index: 24.49°C 76.09°F
  Humidity: 57.00%  Temperature: 24.50°C 76.10°F  Heat index: 24.49°C 76.09°F
  Humidity: 57.00%  Temperature: 24.50°C 76.10°F  Heat index: 24.49°C 76.09°F
  Humidity: 57.00%  Temperature: 24.50°C 76.10°F  Heat index: 24.49°C 76.09°F
  Humidity: 57.00%  Temperature: 24.50°C 76.10°F  Heat index: 24.49°C 76.09°F
  Humidity: 57.00%  Temperature: 24.50°C 76.10°F  Heat index: 24.49°C 76.09°F
  Humidity: 57.00%  Temperature: 24.50°C 76.10°F  Heat index: 24.49°C 76.09°
</pre>
</div>

<h2><a id="h4-2"></a><span class="secno">4.2　</span>Webに公開しよう</h2>

<h4><a id="h4-2-0-1"></a>SSIDとは</h4>
<p>アクセスポイントの名前SSID（Service Set Identifier）とはIEEE802.11（Wi-Fi　無線LANの通信規格）で定められているアクセスポイントの識別子のこと混線を避けるため名付けられている長さは最大32文字</p>

<h3><a id="h4-2-1"></a>ambientについて</h3>
<p>AmbientはIoTデータの可視化サービスです。https://ambidata.io/</p>
<div id="id_1" class="image">
<img src="images/sensor/1.png" alt="ambientのトップページ" />
<p class="caption">
図4.7: ambientのトップページ
</p>
</div>
<div id="id_2" class="image">
<img src="images/sensor/2.png" alt="ユーザ登録" />
<p class="caption">
図4.8: ユーザ登録
</p>
</div>
<div id="id_3" class="image">
<img src="images/sensor/3.png" alt="登録完了メール" />
<p class="caption">
図4.9: 登録完了メール
</p>
</div>
<div id="id_4" class="image">
<img src="images/sensor/4.png" alt="ログイン画面" />
<p class="caption">
図4.10: ログイン画面
</p>
</div>
<p>チャネルを作成します。</p>
<div id="id_5" class="image">
<img src="images/sensor/5.png" alt="チャネル作成完了画面" />
<p class="caption">
図4.11: チャネル作成完了画面
</p>
</div>
<div id="id_7" class="image">
<img src="images/sensor/7.png" alt="ambient用ライブラリのインストール" />
<p class="caption">
図4.12: ambient用ライブラリのインストール
</p>
</div>

<h4><a id="h4-2-1-1"></a>ライブラリのインストール</h4>

<h4><a id="h4-2-1-2"></a>回路図</h4>

<h4><a id="h4-2-1-3"></a>コーディング</h4>
<div id="amibient" class="caption-code">
<p class="caption">リスト4.4: amibient</p>
<pre class="list">#include &quot;Ambient.h&quot;
#include &lt;WiFi.h&gt;

#include &quot;DHT.h&quot;

#define DHTPIN 4
#define PERIOD 30
WiFiClient client;
Ambient ambient;
#define DHTTYPE DHT11 // DHT 11

unsigned long delayTime;
float temp;
float pressure;
float humid;

unsigned int channelId = 39400;            // AmbientのチャネルID(数字)
const char *writeKey = &quot;624168ad3f97c4b9&quot;; // ライトキー

DHT dht(DHTPIN, DHTTYPE);
void setup()
{
  Serial.begin(115200);
  WiFi.begin(&quot;elecom-b2809f-g&quot;, &quot;fapd4rpfac3u&quot;); //  Wi-Fiの初期化

  while (WiFi.status() != WL_CONNECTED)
  { //  Wi-Fiアクセスポイントへの接続待ち
    delay(500);
  }
  dht.begin();
  ambient.begin(channelId, writeKey, &amp;client); //  チャネルIDとライトキーを指定してAmbientの初期化
}

void loop()
{
  // Wait a few seconds between measurements.
  delay(2000);

  // Reading temperature or humidity takes about 250 milliseconds!
  // Sensor readings may also be up to 2 seconds &#39;old&#39; (its a very slow sensor)
  float h = dht.readHumidity();
  // Read temperature as Celsius (the default)
  float t = dht.readTemperature();
  // Read temperature as Fahrenheit (isFahrenheit = true)
  float f = dht.readTemperature(true);

  // Check if any reads failed and exit early (to try again).
  if (isnan(h) || isnan(t) || isnan(f))
  {
    Serial.println(F(&quot;Failed to read from DHT sensor!&quot;));
    return;
  }

  // Compute heat index in Fahrenheit (the default)
  float hif = dht.computeHeatIndex(f, h);
  // Compute heat index in Celsius (isFahreheit = false)
  float hic = dht.computeHeatIndex(t, h, false);
  ambient.set(1, h);
  ambient.set(2, t);
  ambient.set(3, f);

  ambient.send(); //  Ambientにデーターを送信

  delay(PERIOD * 1000);
}
</pre>
</div>
      </div>
      <nav class="book-navi book-prev">
                <a href="electronic.html">
          <div class="book-cursor"><span class="cursor-prev">◀</span></div>
        </a>
              </nav>
      <nav class="book-navi book-next">
                <a href="serverclient.html">
          <div class="book-cursor"><span class="cursor-next">▶</span></div>
        </a>
              </nav>
    </div>
  </div>
  <footer>
      </footer>
</body>
</html>
